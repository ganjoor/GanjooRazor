@page
@model GanjooRazor.Pages.ContentModel
@{
    Layout = "Shared/_GanjoorPage";
}


<div id="hdr2" class="clearfix">
    <h1><a href="/" title="گنجور"><img src="/image/ganjadabk.gif" alt="گنجور" /></a></h1>
    <div class="actionbox">
        <form action="/index.php" method="get" id="searchform">
            <input type="text" name="s" id="s" class="inputText" value="" placeholder="جستجو" />
            <select name="author" id="author">
                <option value="0" selected="selected">در آثار همه شاعران</option>
                @{
                    foreach (RMuseum.Models.Ganjoor.ViewModels.GanjoorPoetViewModel poet in Model.Poets)
                    {
                        if (Model.GanjoorPage.PoetOrCat != null && poet.Id == Model.GanjoorPage.PoetOrCat.Poet.Id)
                        {
                            <option value="@poet.Id" selected="selected">@Html.Raw(poet.Name)</option>
                        }
                        else
                        {
                            <option value="@poet.Id">@Html.Raw(poet.Name)</option>
                        }

                    }
                }
            </select>
            @{
                if (!Model.PoetPage && Model.GanjoorPage.PoetOrCat != null)
                {
                    <select name="cat" id="cat" style="width:150px">
                        <option value="0">در همه بخشها</option>
                        @{
                            foreach (var gran in Model.GanjoorPage.PoetOrCat.Cat.Ancestors)
                            {
                                <option value="@Html.Raw(gran.Id)">@Html.Raw(gran.Title)</option>
                            }
                            <option value="@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.Id)">@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.Title)</option>

                            foreach (var child in Model.GanjoorPage.PoetOrCat.Cat.Children)
                            {
                                <option value="@Html.Raw(child.Id)">@Html.Raw(child.Title)</option>
                            }
                        }
                    </select>
                }
            }

            <input type="submit" value="بیاب" />
        </form>
    </div><!-- .actionbox -->
</div><!-- #hdr2 -->


<div id="fa">
    <div id="maincnt">

        <div class="poem" id="post-@Html.Raw(Model.GanjoorPage.Id.ToString())">
            <article>
                <h2>
                    @{
                        if (Model.PoemPage)
                        {
                            <a href="@Html.Raw(Model.GanjoorPage.Poem.FullUrl)" rel="bookmark">
                                @Html.Raw(Model.GanjoorPage.Poem.Title)
                            </a>
                        }
                        else
                        if (Model.GanjoorPage.PoetOrCat != null)
                        {
                            <a href="@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.FullUrl)" rel="bookmark">
                                @Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.Title)
                            </a>
                        }
                        else
                        {
                            <a href="@Html.Raw(Model.GanjoorPage.FullUrl)" rel="bookmark">
                                @Html.Raw(Model.GanjoorPage.Title)
                            </a>
                        }
                    }

                </h2>
                @{
                    if (Model.GanjoorPage.PoetOrCat != null)
                    {
                        <div class="spacer">&nbsp;</div>
                        <div style="width:82px;margin:auto">
                            <a href="@Html.Raw(Model.GanjoorPage.PoetOrCat.Poet.FullUrl)"><img src="https://raw.githubusercontent.com/ganjoor/ganjoorflutter/main/images/poets/@(Model.GanjoorPage.PoetOrCat.Poet.Id).png" alt="@Html.Raw(Model.GanjoorPage.PoetOrCat.Poet.Name)" /></a>
                        </div>
                        <div style="width:100%;margin:auto">
                            @{
                                foreach (var gran in Model.GanjoorPage.PoetOrCat.Cat.Ancestors)
                                {
                                    <a href="@Html.Raw(gran.FullUrl)">@Html.Raw(gran.Title)</a><span> &raquo;</span>
                                }
                                <a href="@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.FullUrl)">@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.Title)</a>
                            }

                        </div>
                    }
                }

                <div class="spacer">&nbsp;</div>
                @{
                    @Html.Raw(Model.GanjoorPage.HtmlText)
                }


            </article>

            @{
                if (Model.PoemPage)
                {
                    if (Model.GanjoorPage.Poem.Recitations.Length > 0)
                    {
                        <div class="spacer">&nbsp;</div>
                        <div style="width:95%;max-width:500px;margin:auto">
                            <div id="jp_container_1" class="jp-video jp-video-270p">
                                <div class="jp-type-playlist">
                                    <div id="jquery_jplayer_1" class="jp-jplayer"></div>
                                    <div class="jp-gui">
                                        <div class="jp-video-play">
                                            <button class="jp-video-play-icon" tabindex="0">پخش</button>
                                        </div>
                                        <div class="jp-interface">
                                            <div class="jp-progress">
                                                <div class="jp-seek-bar">
                                                    <div class="jp-play-bar"></div>
                                                </div>
                                            </div>
                                            <div class="jp-current-time">&nbsp;</div>
                                            <div class="jp-duration">&nbsp;</div>
                                            <div class="jp-controls-holder" style="width:auto">
                                                <div class="jp-controls">
                                                    <button class="jp-previous" tabindex="0">قبلی</button>
                                                    <button class="jp-play" tabindex="0">پخش</button>
                                                    <button class="jp-next" tabindex="0">بعدی</button>
                                                    <button class="jp-stop" tabindex="0">توقف</button>
                                                </div>
                                                <div class="jp-volume-controls">
                                                    <button class="jp-mute" tabindex="0">بی‌صدا</button>
                                                    <button class="jp-volume-max" tabindex="0">حداکثر صدا</button>
                                                    <div class="jp-volume-bar">
                                                        <div class="jp-volume-bar-value"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="jp-details">
                                                <div class="jp-title">&nbsp;</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="jp-playlist">
                                        <ul>
                                            <!-- The method Playlist.displayPlaylist() uses this unordered list -->
                                            <li>&nbsp;</li>
                                        </ul>
                                    </div>
                                    <div class="jp-no-solution">
                                        <span>نیاز به بروزآوری</span>
                                        جهت خوانش شعر شما یا باید از مرورگر جدیدی همچون <a href="http://getfirefox.com/">فایرفاکس</a> استفاده کنید یا افزونه <a href="http://get.adobe.com/flashplayer/" target="_blank">فلش</a> مرورگرتان را بروزآوری کنید.
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
            }


            @{
                if (Model.CatPage)
                {
                    <nav>
                        <div class="spacer">&nbsp;</div>
                        <div class="navigation">
                            <div class="navleft">
                                @if (Model.GanjoorPage.PoetOrCat.Cat.Next != null)
                                {
                                    <a href="@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.Next.UrlSlug)">@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.Next.Title)</a><span> &raquo;</span>
                                }
                            </div>
                            <div class="navright">
                                @if (Model.GanjoorPage.PoetOrCat.Cat.Previous != null)
                                {
                                    <span>&laquo; </span><a href="@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.Previous.UrlSlug)">@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.Previous.Title)</a>
                                }
                            </div>
                        </div>
                    </nav>
                }

                if (Model.PoemPage)
                {

                    <nav>
                        <div class="spacer">&nbsp;</div>
                        <div class="navigation">
                            <div class="navleft">
                                @if (Model.GanjoorPage.Poem.Next != null)
                                {
                                    <a href="@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.FullUrl + "/" + Model.GanjoorPage.Poem.Next.UrlSlug)">@Html.Raw(Model.GanjoorPage.Poem.Next.Title): @Html.Raw(Model.GanjoorPage.Poem.Next.Excerpt)</a><span> &raquo;</span>
                                }
                            </div>
                            <div class="navright">
                                @if (Model.GanjoorPage.Poem.Previous != null)
                                {
                                    <span>&laquo; </span><a href="@Html.Raw(Model.GanjoorPage.PoetOrCat.Cat.FullUrl + "/" +Model.GanjoorPage.Poem.Previous.UrlSlug)">@Html.Raw(Model.GanjoorPage.Poem.Previous.Title) :@Html.Raw(Model.GanjoorPage.Poem.Previous.Excerpt)</a>
                                }
                            </div>
                        </div>
                    </nav>

                    <div id="comments">
                        <p>
                            <small>🖰 با دو بار کلیک روی واژه‌ها یا انتخاب متن و کلیک روی آنها می‌توانید آنها را در لغتنامهٔ دهخدا جستجو کنید.</small>
                        </p>
                        <p>
                            <small>🖐 <a href="#" onclick="javascript:btshmr()">شماره‌گذاری ابیات</a></small>
                            | <small>منبع اولیه: <a href="/sources/sj/">سیاوش جعفری</a></small> | <small><a href="http://www.facebook.com/sharer.php?u=/onsori/oghat/sh9/&amp;t=%D8%B4%D9%85%D8%A7%D8%B1%D9%87%D9%94+%DB%B9/">ارسال به فیس‌بوک</a></small>
                        </p>
                        <h3>این شعر را چه کسی در کدام آهنگ خوانده است؟</h3>
                        <p>🎜 <small><a href="/spotify/?p=68936" onclick="wpopen(this.href); return false" class="comments-link">معرفی آهنگهایی که در متن آنها از این شعر استفاده شده است</a> ...</small></p>

                        @if (Model.GanjoorPage.Poem.Images.Length == 0)
                        {
                            <p>
                                <small>📷 <a href="?pinterest_url=manual" onclick="wpopen(this.href); return false" class="comments-link">پیشنهاد تصاویر مرتبط از منابع اینترنتی</a>، 📖 <a href="http://blog.ganjoor.net/1398/07/12/mganjoor/" target="_blank">راهنمای نحوهٔ پیشنهاد تصاویر مرتبط از گنجینهٔ گنجور</a></small>
                            </p>
                        }
                        else
                        {
                            <h3>تصاویر مرتبط در گنجینهٔ گنجور</h3>
                            <div style="display: flex;clear: both;width:auto;margin:auto;flex-flow:wrap;text-align:center">
                                @foreach (var image in Model.GanjoorPage.Poem.Images)
                                {
                                    <a target="_blank" style="text-align:center;margin:auto" href="@Html.Raw(image.TargetPageUrl)">
                                        <img src="@Html.Raw(image.ThumbnailImageUrl)" alt="@Html.Raw(image.AltText)" width="200" style="width:200px;float: right;padding: 5px;">
                                    </a>
                                }
                            </div>
                        }

                        <h3>حاشیه‌ها</h3>
                        <p>

                            تا به حال حاشیه‌ای برای این شعر نوشته نشده است. <a href="/?comments_popup=68936" onclick="wpopen(this.href); return false" class="comments-link" title="Comment on شمارهٔ ۹">💬 شما حاشیه بگذارید ...</a>
                        </p>
                    </div> <!-- <div id="comments"> -->
                }



            }


            <div class="spacer">&nbsp;</div>

        </div>

        <div class="helpers">

            <div class="cat">
            </div>

            <div class="com">

            </div>

        </div>




    </div>

    <div id="footer">
        <ul>
            <li><a href="/">خانه</a> | </li>
            <li><a href="/random/">بیت تصادفی</a> | </li>
            <li><a href="/mundex/">نمایهٔ موسیقی</a> | </li>
            <li><a href="http://blog.ganjoor.net/">تازه‌ها</a> | </li>
            <li><a href="/hashieha/">حاشیه‌ها</a> | </li>
            <li><a href="http://c.ganjoor.net">کدها</a> | </li>
            <li><a href="http://dg.ganjoor.net">رومیزی</a> | </li>
            <li><a href="http://pozh.org/saaghar/">ساغر</a> | </li>
            <li><a href="http://epub.ganjoor.net">کتابخانه</a> | </li>
            <li><a href="https://museum.ganjoor.net">گنجینه</a> | </li>
            <li><a href="/vazn/">آمار</a> | </li>
            <li><a href="/about/">معرفی</a> | </li>
            <li><a href="/sources/">منابع</a> | </li>
            <li><a href="/donate/">کمک</a> | </li>
            <li><a href="/contact/">تماس</a></li>
        </ul>
    </div>


</div>


<script src="/lib/jquery/dist/jquery.min.js"></script>
<script src="/js/bd.js"></script>
<script src="/js/vaabc.js"></script>

@{
    if(Model.PoemPage)
    {
        if(Model.GanjoorPage.Poem.Recitations.Length > 0 )
        {
            <script src="/dist/jplayer/jquery.jplayer.min.js"></script>
            <script src="/dist/add-on/jplayer.playlist.min.js"></script>
            <script>
                //<![CDATA[
                $(document).ready(function () {
                    var jlist = prepaudio(
                        "@Html.Raw($"https://ganjgah.ir/api/audio/file/{Model.GanjoorPage.Poem.Recitations[0].Id}.xml")",
                        "@Html.Raw(Model.GanjoorPage.Poem.Recitations[0].AudioTitle)",
                        "@Html.Raw(Model.getAudioDesc(Model.GanjoorPage.Poem.Recitations[0], true))",
                        "",
                        "@Html.Raw(Model.GanjoorPage.Poem.Recitations[0].Mp3Url)"
                    );

                    @for(int x = 1; x<Model.GanjoorPage.Poem.Recitations.Length; x++)
                    {
                        <text>
                    addpaudio(@x, jlist,
                        "@Html.Raw($"https://ganjgah.ir/api/audio/file/{Model.GanjoorPage.Poem.Recitations[x].Id}.xml")",
                        "@Html.Raw(Model.GanjoorPage.Poem.Recitations[x].AudioTitle)",
                        "@Html.Raw(Model.getAudioDesc(Model.GanjoorPage.Poem.Recitations[x], false))",
                        "",
                        "@Html.Raw(Model.GanjoorPage.Poem.Recitations[x].Mp3Url)"
                    );
                        </text>
                    }

                });
                //]]>
            </script>
        }
    }
}
